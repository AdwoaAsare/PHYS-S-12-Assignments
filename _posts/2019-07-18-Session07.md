---
layout: post
title:  "07: Electronic Input Devices"
permalink: /07/
---

### Capacitative Measurement

For my final project I am making an automatic plant watering pot. For that there will be a water storage tank to hold water for pumping into the soil. I want the tank to have way to measure the water level in the tank so it can light up if the water level is too low. For this weeks lab my goal was to test out making a water level sensor on a disposable water bottle.

The water level meter measure the capacitance to determine the water level. In order to determine what outputs went occured with what water levels, i modeled the situation with an equation that I could put into the code. In order to derive that equation I took five hundred data points and used linearition methods.

<img src="meter.JPG" alt="meter">

###Build:

1. Cut two 1.5 centimeter wide strips of copper tape for the height of your bottle
2. Sauter 22 gauge wire to the end of each
3. Put electrical tape over the connections
4. Take off the backing of the copper tape and tape the strips onto the bottle vertically
5. Plug one wire into digital pin 4 on the arduino and the other into analog zero

The the circuit is complete.

###Calibration:

Download <a href='stepCapCalibration.ino' download>this</a> arduino code onto the arduino to begin calibration...

- Data Collection

1. Empty the bottle and run the code with the serial monitor (0 percent full or for our purposes 0.00)
2. Copy the first 100 data points from the serial monitor and put them into column E of the excel sheet
3. Fill the bottle to be a quarter full and clear the serial monitor (25 percent full or for our purposes 0.25)
4. Copy the first 100 data points from the serial monitor and put them into column D of the excel sheet
5. Fill the bottle to be a half full and clear the serial monitor (50 percent full or for our purposes 0.50)
6. Copy the first 100 data points from the serial monitor and put them into column C of the excel sheet
3. Fill the bottle to be a 3 quarters full and clear the serial monitor (75 percent full or for our purposes 0.75)
4. Copy the first 100 data points from the serial monitor and put them into column B of the excel sheet
3. Fill the bottle to be full and clear the serial monitor (100 percent full or for our purposes 1.00)
4. Copy the first 100 data points from the serial monitor and put them into column A of the excel sheet

- Average each column of data using the AVERAGE function on Excel (this also works on google sheets)
- Make a table of water level vs output (water levels should be 0.00-1.00 and need to matched up with their corresponding averages)
- Graph the data and determine what parent function it best matches, then once you figure it out, linearize the data set
- Take a best-fit of the linearized data set

If you don't know how to linearize, check out [this](https://www.mrwaynesclass.com/labs/reading/index06.html) link!

When I was trying to linearize my data I had trouble at first because I was convinced that the data represented a root function so my linearization wasn't quite working out. I decided to try linearizing it as a cube root function which gave me a much more linear line that I ended up using

-Take the best fit and solve for the water level, this is the equation that needs to be put into the code for the next section

###Measuring Water Level

Download <a href='stepCapacitanceMeter.ino' download>this</a> arduino code to begin water level measurement...

-Replace the return in the waterLevelCalc() method with whatever your equation is for max accuracy

###My Water Level Sensor

Here is a picture of my excel graphs. The one on the left is the graph of the original data and the one on the right is the graph of the linearized data. As you can see, my R^2 value of 0.9918 is very close to 1 so my data shows a strong linear correlation between the cube root of the water level(x-axis) and the capacitance(y-axis). 

<img src="graphs.png" alt="graphs">

Here is my work for solving for the water level

<img src="equation.JPG" alt="equation">


<a href='TestWaterLevelLinearizaton.xlsx' download>Click to download my Excel file</a>

<video width="955" height="541" controls>
	<source src="meterVideo.MOV" type="video/MOV">
</video>


There were some pros and cons of measuring water level this way...

**Pros:**
- gives an estimate for any water level
- allows use of a mathematical equation that can easily be altered

**Cons**  
- after a couple runs, the water level meter loses accuracy (probably from water droplets or other factors)
- _long_ callibration process 

For my water level meter for the final project, what I will probably do is have a meter at the top of the tank and a meter at the bottom and then measure the difference between their capacitance to determine if the water level is running low in order to avoid having to recallibrate all the time.

<img src="potSketch.JPG" alt="potSketch">
<!--p You can also use HTML tags to include a video -->



